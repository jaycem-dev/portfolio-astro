---
import FilterByTag from "@components/FilterByTag.astro";
import { filterProjectsByTag, getProjects } from "@lib/project-collection";
import ProjectCard from "@components/ProjectCard.astro";
import Link from "@ui/Link.astro";
import ArrowRightIcon from "@assets/icons/arrow-right.svg";
import { getTranslations, type Locale } from "@lib/translations";

export interface Props {
    lang: Locale;
    homepage: boolean;
    title?: string;
    filter?: string;
}

const { lang, homepage, filter, title } = Astro.props;
const t = getTranslations(lang);

let data = await getProjects(homepage, lang);

// if a filter is passed as prop, then filter
if (filter) {
    data = filterProjectsByTag(data, filter);
}
---

<section id="projects" class="space-y-12">
    {
        homepage ? (
            <h2>{t.projects.title}</h2>
        ) : (
            <h1 class="text-center">{title}</h1>
        )
    }

    {!homepage && <FilterByTag collection="projects" lang={lang} />}

    <div class="grid gap-8 md:grid-cols-2">
        {data.map((project) => <ProjectCard item={project} lang={lang} />)}
    </div>

    <!--if this component is rendered on the homepage, then render the link to all projects-->
    {
        homepage && (
            <div class="grid justify-end">
                <Link
                    variant="outline"
                    class="group"
                    href={`/${t.routes.projects}`}
                    size="lg"
                    lang={lang}
                >
                    <span>{t.projects.seeMore}</span>
                    <ArrowRightIcon
                        class="transition-transform group-hover:translate-x-1"
                        width={18}
                        height={18}
                    />
                </Link>
            </div>
        )
    }
</section>
